{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Интерактивная карта</title>
  <style>
    body { font-family: sans-serif; background: #fffdf5; padding: 20px; }
    #map { width: 100%; height: 600px; border-radius: 8px; }
    .popup-card { width: 240px; font-size: 13px; }
    .popup-card img { width: 100%; height: 140px; object-fit: cover; border-radius: 6px; margin-bottom: 6px; }
    .popup-card h4 { margin: 0 0 4px; font-size: 16px; color: #333; }
    .popup-card p { margin: 0; color: #555; }
  </style>
</head>
<body>
  <h2>Карта достопримечательностей</h2>
  <div id="map"></div>

  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
  <script>
    ymaps.ready(function () {
        var map = new ymaps.Map("map", {
            center: [55.751244, 37.618423],
            zoom: 11
        });

        fetch("{% url 'places_geojson' %}")
          .then(response => response.json())
          .then(data => {
              if (data.features.length > 0) {
                  var firstCoords = [data.features[0].geometry.coordinates[1], data.features[0].geometry.coordinates[0]];
                  map.setCenter(firstCoords);
              }

              data.features.forEach(f => {
                  var coords = [f.geometry.coordinates[1], f.geometry.coordinates[0]];
                  var placemark = new ymaps.Placemark(coords, {
                      balloonContent: `
                          <div class="popup-card">
                              <img src="${f.properties.image}" alt="${f.properties.name}">
                              <h4>${f.properties.name}</h4>
                              <p>${f.properties.description}</p>
                          </div>
                      `
                  }, { preset: 'islands#redDotIcon' });
                  map.geoObjects.add(placemark);
              });
          })
          .catch(err => console.error("Ошибка загрузки GeoJSON:", err));
    });
  </script>
</body>
</html>
